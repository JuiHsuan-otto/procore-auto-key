# VERSION_SOP.md — 版本管理標準操作規範
> 適用對象：所有涉及重大內容異動的操作
> 強制規定：版本切換前必須完整執行本 SOP

---

## 🚦 三種操作等級
| 等級 | 觸發條件 | 必要動作 |
|---|---|---|
| 🔴 **Major**（重大）| 架構重構、首頁改版、資料庫異動 | 完整 SOP + 備份 + 主管確認 |
| 🟡 **Minor**（中等）| 新增功能、文章批次上線、版面調整 | 基本 SOP + 資產快照 |
| 🟢 **Patch**（輕微）| 文字修正、小圖更換、單篇文章異動 | 記錄即可，無需備份 |

---

## ✅ 重大版本切換完整檢查清單
請依序執行，每步驟完成後打勾（✓）。

### 【Phase 1】操作前準備
```
[ ] 1-1 確認當前版本號（查閱 MEMORY.md）
[ ] 1-2 決定新版本號（遵循 Semantic Versioning）
      Major.Minor.Patch → 例：v1.2.0
[ ] 1-3 記錄操作開始時間
[ ] 1-4 通知相關人員（如有必要）
```

### 【Phase 2】資產快照
```
[ ] 2-1 執行 pre_version_change.py 自動生成資產清單
[ ] 2-2 確認資產清單與實際狀況一致
[ ] 2-3 備份關鍵資產至 /backups/{版本號}/
[ ] 2-4 確認備份檔案完整性（比對檔案大小/數量）
```

### 【Phase 3】文章狀態確認
```
[ ] 3-1 確認所有「上線中」文章可正常存取
[ ] 3-2 確認「草稿」文章不會意外曝光
[ ] 3-3 記錄當前文章清單快照（含 URL + 狀態）
[ ] 3-4 標記哪些文章屬於本次版本的改動範圍
```

### 【Phase 4】版本標記
```
[ ] 4-1 建立 Git Tag：git tag -a v{版本號} -m "{說明}"
[ ] 4-2 推送 Tag：git push origin v{版本號}
[ ] 4-3 更新 MEMORY.md 版本歷史區塊
[ ] 4-4 更新 MEMORY.md 關鍵資產清單
```

### 【Phase 5】上線後驗證
```
[ ] 5-1 確認頁面正常載入（主要入口頁）
[ ] 5-2 確認核心功能正常運作
[ ] 5-3 記錄操作完成時間
[ ] 5-4 更新 MEMORY.md 重要節點備忘
[ ] 5-5 通知相關人員（如有必要）
```

---

## 📐 版本號命名規則（Semantic Versioning）
```
v{MAJOR}.{MINOR}.{PATCH}

MAJOR — 不相容的重大架構改變
MINOR — 新增功能，向下相容
PATCH — 小修正、文字更正

範例：
v1.0.0 → 初始正式版本
v1.1.0 → 新增功能
v1.1.1 → 修正小 bug
v2.0.0 → 重大架構改版
```

---

## 📁 備份目錄結構規範
```
/backups/
├── snapshots/
│   ├── v1.0.0/
│   │   ├── asset_list.json    ← 資產清單快照
│   │   ├── article_list.json  ← 文章狀態快照
│   │   └── metadata.json      ← 版本元資料
│   └── v1.1.0/
│       └── ...
└── full/
    ├── v1.0.0.tar.gz         ← 必要時的完整備份
    └── ...
```

---

## 🔁 緊急回滾流程
> 上線後發現嚴重問題時執行

```bash
# 1. 確認要回滾的目標版本
git log --oneline --tags

# 2. 切換至目標版本
git checkout v{目標版本號}

# 3. 還原備份資產（如有異動靜態資產）
cp -r /backups/{目標版本號}/* ./

# 4. 確認回滾成功後更新 MEMORY.md
# 記錄：回滾時間、原因、回滾至哪個版本
```

---

## 📅 定期維護排程
| 頻率 | 工作項目 |
|---|---|
| 每次異動 | 更新 MEMORY.md 對應區塊 |
| 每週 | 檢視待辦與風險項目清單 |
| 每月 | 整理 MEMORY.md，清除過期資訊 |
| 每季 | 審視 SOP 是否需要更新 |